<!DOCTYPE html>
<html lang="it-IT">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>profile</title>
    <link type="text/CSS" rel="stylesheet" href="profile_page.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.2/FileSaver.min.js"></script>
    <script src="js/profile_page.js"></script>
    <script src="js/script_selezione.js"></script>
    <script src="js/scarica.js"></script>
    <link rel="icon" href="img\logo_favicon.ico" type="image/x-icon">
    <!-- inserire qui una nuova immagine come logo della finestra nel browser, chiedere a forna di farla-->
</head>

<body onload="setAll()">
    <!--<?php
        session_start();
        $conn = new mysqli("localhost","root","","share-notes");
        include "utils.inc.php";

        if (isLogged()) {
            echo "<script>alert('Devi prima loggarti per poter prendere appunti.')
                    setTimeout(function() {
                    window.location.replace(\"index.html\");
                    }, 0)
                </script>";
        }

        if(isset($_POST['share'])){ //da aggiungere  a Matte...
            $code = $_POST['share'];
            $checkShare = "SELECT mia FROM nota WHERE codicenota=$code";
            $resultCShare = $conn->query($checkShare);
            $mia = ($resultCShare->fetch_assoc())['mia'];
            if($mia == 1){
                $queryShare = "UPDATE nota SET condivisa=1 WHERE codicenota=$code";
                $resultShare = $conn->query($queryShare);
                if(!$resultShare){
                    echo '<script>
                        alert("Non e\' stato possibile condividere la nota, riprova in seguito...");
                    </script>';
                }
            }else {
                echo '<script>
                    alert("Non puoi condividere una nota non tua, devi prima modificarla...");
                </script>';
            }
        }

        if(isset($_POST['creaNota']) and ((int) $_POST['creaNota']) == 1){
            if (sexOrCock()){
                $mail = (string) $_SESSION["UserData"]["email"];
                $classe = (string) $_SESSION["UserData"]["classe"];
            }else {
                $mail = (string) $_COOKIE["UserMail"];
                $queryClass = "SELECT * FROM user WHERE mail='$mail'";
                $resultClass = $conn->query($queryClass);
                $classe = ($resultClass->fetch_assoc())['classe'];
            }
            $titolo = "NotaBianca";
            $querySearch = "SELECT * FROM nota WHERE email='$mail' and titolo='$titolo'";
            $resultSearch = $conn->query($querySearch);
            
            if($resultSearch->num_rows > 0){
                echo '<script>
                    alert("Hai già una nuova nota non modificata!?!; Sei pregato di usare prima quella.");
                </script>';
            }else{
                $queryNuovaNota = "INSERT INTO nota(email, classe) VALUES ('$mail','$classe')";
                $resultNuovaNota = $conn->query($queryNuovaNota);
                $queryCodice = "SELECT * FROM nota WHERE email='$mail' and titolo='$titolo'";
                $resultCodice = $conn->query($queryCodice);
                $codiceAr = $resultCodice->fetch_assoc();
                $codice = $codiceAr["codicenota"];
                echo '<form method="post" action="download.php" id="fTSend">
                    <input type="number" name="codNota" style="display: none;" value='.$codice.'>
                </form>
                <script>
                    document.getElementById("fTSend").submit();
                </script>';
            }
            unset($_POST['creaNota']);
        }

        if (isset($_SESSION["UserData"])){
            $mail = (string) $_SESSION["UserData"]["email"];
			$nomeUtente = (string) $_SESSION["UserData"]["name"];
        }else {
            $mail = (string) $_COOKIE["UserMail"];
			$query_nome = "SELECT name FROM user WHERE email='".trim($mail)."'";
			$result_nome = $conn->query($query_nome);
			$nomeUtente = (string) ($result_nome->fetch_assoc())['name'];
        }

        if(isset($_POST['eliminaNota'])){
            $checkNota = "SELECT * FROM nota WHERE email='$mail'";
            $resultCheck = $conn->query($checkNota);
            $numNota = $resultCheck->num_rows;
            if($numNota > 1){
                $code = $_POST['eliminaNota'];
                $eliminazione = "DELETE FROM nota WHERE codicenota=$code";
                $resultEliminazione = $conn->query($eliminazione);
                if(!$resultEliminazione){
                    echo '<script>
                        alert("La nota non e\' stata eliminata correttamente, riprovare in seguito...");
                    </script>';
                }
            }else {
                echo '<script>
                        alert("La nota che stai tentando di eliminare e\' l\'ultima che ti rimane, non puoi eliminarla...");
                    </script>';
            }
        }

        if(isset($_POST['Classe'])){
            $year = (int) $_POST['Classe'];
        }

        if(isset($_POST['Proprieta'])){
            $mine = (int) $_POST['Proprieta'];
        }

        function printNote($codice, $title, $content){ //In più rispetto a Matte... (poi da aggiungere)
            echo '<form method="POST" action="download.php">
                <button name="codNota" id="bottoneNota" value=', $codice, '>', $title,'</button>
            </form>';
            echo '<button onclick="downloadNota(\''.$title.'\',\''.$content.'\')">Download '.$title.'</button>';
            echo '<form>
                <button name="share" value='.$codice.'>Condividi '.$title.'</button>
            </form>';
            echo '<form method="POST" action="profile_page.php">
                <button name="eliminaNota" value='.$codice.'>Elimina '.$title.'</button>
            </form>';
        }

		function mostra($mat, $mail, $conn, $anno = 0, $appartenenza = 2){
            $anno = (int) $anno;
            $appartenenza = (int) $appartenenza;
			$query_num_mate = "SELECT * FROM nota WHERE email='$mail' and materia='$mat'";
			$result_num_mate = $conn->query($query_num_mate);
			$num_mate = mysqli_num_rows($result_num_mate);
			$mate = array();
			while ($row = $result_num_mate->fetch_assoc()) {
				$mate[] = $row;
			}
			for ($j = 0; $j < $num_mate; $j++) {
				$codice = $mate[$j]['codicenota'];
				$title = $mate[$j]['titolo'];
                $app = (int) $mate[$j]['mia'];
                $ann = (int) $mate[$j]['annoScolastico'];
                $content = (string) $mate[$j]['contenuto'];
                if($appartenenza == 2){
                    if($anno == 0){
                        printNote($codice, $title, $content);
                    }else if($anno == $ann){
                        printNote($codice, $title, $content);
                    }
                }else if($appartenenza == $app){         //da aggiungere tutti i printNote...
                    if($anno == 0){
                        printNote($codice, $title, $content);
                    }else if($anno == $ann){
                        printNote($codice, $title, $content);
                    }
                }
			}
		}

        function stampaMaterie($conn){        //da aggiungere a Matteo...
            $queryMaterie = "SELECT * FROM materia";
            $resultMaterie = $conn->query($queryMaterie);
            $numMaterie = $resultMaterie->num_rows();
            $Materie = $resultMaterie->fetch_assoc();
            for($j = 0; $j < $numMaterie; $j++){
                echo '<option value="'.$Materie[$j]['nome'].'">'.$Materie[$j]['nome'].'</option>';
            }
        }
        ?>-->
    <div class='container-verti'>
        <div class='horizontal'>
            <a href="index.php"><img class="logo" src="img/logo.png"></a>
            <a href="index.php"><button class="top-buttons-style">Home</button></a>
            <a href="aboutPage.html"><button class="top-buttons-style">Chi siamo?</button></a>
            <a href="#"><button class="top-buttons-style">Cerca appunti</button></a>
            <a href="#"><button class="top-buttons-style">Funzionalità</button></a>
            <hr class="line-horizontal">
            <div class="open-zone">
                <h1 class="main-title">Appunti</h1>
                <div class="scrollable">
                    <div class="folders" id="folder-math" onclick="cambiaStatoMateria('folder-math')">
                        <h6 class="math" id="titleSub-math">Matematica
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('matematica', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('matematica', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('matematica', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('matematica', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-ita" onclick="cambiaStatoMateria('folder-ita')">
                        <h6 class="ita" id="titleSub-ita">Italiano
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('italiano', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('italiano', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('italiano', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('italiano', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-storia" onclick="cambiaStatoMateria('folder-storia')">
                        <h6 class="storia" id="titleSub-storia">Storia
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('storia', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('storia', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('storia', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('storia', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-ict" onclick="cambiaStatoMateria('folder-ict')">
                        <h6 class="ict" id="titleSub-ict">Informatica
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('informatica', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('informatica', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('informatica', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('informatica', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-tlc" onclick="cambiaStatoMateria('folder-tlc')">
                        <h6 class="tlc" id="titleSub-tlc">Telecomunicazioni
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('telecomunicazioni', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('telecomunicazioni', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('telecomunicazioni', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('telecomunicazioni', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-tpsi" onclick="cambiaStatoMateria('folder-tpsi')">
                        <h6 class="tpsi" id="titleSub-tpsi">TPSI
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('tpsi', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('tpsi', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('tpsi', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('tpsi', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-try" onclick="cambiaStatoMateria('folder-try')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-ty" onclick="cambiaStatoMateria('folder-ty')">
                        <h6 class="try" id="titleSub-try">PROVA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                </div>
                <p class="crea-txt">Crea</p>
                <form action="profile_page.php" method="post">
                    <button value=1 name="creaNota" style="background:none; border:none;"> <!-- da aggiungere a matte... -->
                        <img src="img\create.png" class="create-btn">
                    </button>
                </form>
            </div>
        </div>
        <hr class="line-vertical">
        <div class='vertical'>
            <img src="img/user.png" class="user-img">
            <h1 class="center-user-name"><!--<?php echo $nomeUtente ?>-->
                <h1>
                    <h3 class="center-user-mail"><!--<?php echo $mail ?>-->
                        <h3>
                            <div class="line-horizontal"></div>
                            <h3 class="divisions">Divisioni</h3>
                            <nav class="division-column">
                                <ul>
                                    <li>
                                        <select id="materia" name="Materia" class="options-dims" onchange="sort('folder-' + this.value, 'folders', this.value)">
            					            <option value="all">All</option>
  								            <option value="math">Matematica</option>
  								            <option value="ita">Italiano</option>
 								            <option value="storia">Storia</option>
  								            <option value="ict">Informatica</option>
  								            <option value="tlc">Telecomunicazione</option>
  								            <option value="tpsi">TPSI</option>
								            <option value="try">PROVA</option>
							            </select>
                                    </li>
                                    <form action="profile_page.php" method="post" id="formFilter">
                                        <li>
                                            <select id="classe" name="Classe" class="options-dims" onchange="submitSelected('classe')">
            					                <option value=0>All</option>
  								                <option value=1>Prima</option>
  								                <option value=2>Seconda</option>
 								                <option value=3>Terza</option>
  								                <option value=4>Quarta</option>
  								                <option value=5>Quinta</option>
							                </select>
                                        </li>
                                        <li>
                                            <select id="proprita" name="Proprieta" class="options-dims" onchange="submitSelected('proprita')">
            					                <option value=2>All</option>
  								                <option value=1>Creati da te</option>
  								                <option value=0>Creati da altri</option>
							                </select>
                                        </li>
                                    </form>
                                    <ul>
                            </nav>
                            <form action="index.php" method="post">
                                <button type="submit" name="loGOut" value=1 style="background:none; border:none;"><img class="exit-btn" src="img\exit.png"></button> <!-- da aggiungere a matte... -->
                            </form>
                            <!--<a href="logout.php"><img class="exit-btn" src="img\exit.png"></a>-->
                            <!--tag probabilmente da cambiare per far uscire l'utente dall'account-->
        </div>
    </div>
</body>

</html>