<!DOCTYPE html>
<html lang="it-IT">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>profile</title>
    <link type="text/CSS" rel="stylesheet" href="profile_page.css">
    <!-- Include JSZip via CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <!-- Include FileSaver via CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.2/FileSaver.min.js"></script>
    <script src="js/profile_page.js"></script>
    <script src="js/script_selezione.js"></script>
    <script src="js/scarica.js"></script>
    <link rel="icon" href="img\logo_favicon.ico" type="image/x-icon">
    <!-- inserire qui una nuova immagine come logo della finestra nel browser, chiedere a forna di farla-->
</head>

<body onload="setAll()">
    <!--<?php
        session_start();
        $conn = new mysqli("localhost","root","","share-notes");
        include "utils.inc.php";

        if (isLogged()) {
            echo "<script>alert('Devi prima loggarti per poter prendere appunti.')
                    setTimeout(function() {
                    window.location.replace(\"index.html\");
                    }, 0)
                </script>";
        }

        if(isset($_POST['creaNota']) and ((int) $_POST['creaNota']) == 1){
            if (sexOrCock()){
                $mail = (string) $_SESSION["UserData"]["email"];
                $classe = (string) $_SESSION["UserData"]["classe"];
            }else {
                $mail = (string) $_COOKIE["UserMail"];
                $queryClass = "SELECT * FROM user WHERE mail='$mail'";
                $resultClass = $conn->query($queryClass);
                $classe = ($resultClass->fetch_assoc())['classe'];
            }
            $titolo = "NotaBianca";
            $querySearch = "SELECT * FROM nota WHERE email='$mail' and titolo='$titolo'";
            $resultSearch = $conn->query($querySearch);
            
            if($resultSearch->num_rows > 0){
                echo '<script>
                    alert("Hai già una nuova nota non modificata!?!; Sei pregato di usare prima quella.");
                </script>';
            }else{
                $queryNuovaNota = "INSERT INTO nota(email, classe) VALUES ('$mail','$classe')";
                $resultNuovaNota = $conn->query($queryNuovaNota);
                $queryCodice = "SELECT * FROM nota WHERE email='$mail' and titolo='$titolo'";
                $resultCodice = $conn->query($queryCodice);
                $codiceAr = $resultCodice->fetch_assoc();
                $codice = $codiceAr["codicenota"];
                echo '<form method="post" action="download.php" id="fTSend">
                    <input type="number" name="codNota" style="display: none;" value='.$codice.'>
                </form>
                <script>
                    document.getElementById("fTSend").submit();
                </script>';
            }
            unset($_POST['creaNota']);
        }

        if (isset($_SESSION["UserData"])){
            $mail = (string) $_SESSION["UserData"]["email"];
			$nomeUtente = (string) $_SESSION["UserData"]["name"];
        }else {
            $mail = (string) $_COOKIE["UserMail"];
			$query_nome = "SELECT name FROM user WHERE email='".trim($mail)."'";
			$result_nome = $conn->query($query_nome);
			$nomeUtente = (string) ($result_nome->fetch_assoc())['name'];
        }

        if(isset($_POST['Classe'])){
            $year = (int) $_POST['Classe'];
        }

        if(isset($_POST['Proprieta'])){
            $mine = (int) $_POST['Proprieta'];
        }

		function mostra($mat, $mail, $conn, $anno = 0, $appartenenza = 2){
            $anno = (int) $anno;
            $appartenenza = (int) $appartenenza;
			$query_num_mate = "SELECT * FROM nota WHERE email='$mail' and materia='$mat'";
			$result_num_mate = $conn->query($query_num_mate);
			$num_mate = mysqli_num_rows($result_num_mate);
			$mate = array();
			while ($row = $result_num_mate->fetch_assoc()) {
				$mate[] = $row;
			}
			echo '<form method="POST" action="download.php">';
			for ($j = 0; $j < $num_mate; $j++) {
				$codice = $mate[$j]['codicenota'];
				$title = $mate[$j]['titolo'];                               //' onClick="assegnaValore(', $codice , ', ',$nomeInput,')" 
                $app = (int) $mate[$j]['mia'];
                $ann = (int) $mate[$j]['annoScolastico'];
                $content = (string) $mate[$j]['contenuto'];
                if($appartenenza == 2){
                    if($anno == 0){
                        echo '<button name="codNota" id="bottoneNota" value=', $codice, '>', $title,'</button>';
                        echo '<button form="noForm" onclick="downloadNota(\''.$title.'\',\''.$content.'\')">Download '.$title.'</button><br>';
                    }else if($anno == $ann){
                        echo '<button name="codNota" id="bottoneNota" value=', $codice, '>', $title,'</button>';
                        echo '<button form="noForm" onclick="downloadNota(\''.$title.'\',\''.$content.'\')">Download '.$title.'</button><br>';
                    }
                }else if($appartenenza == $app){
                    if($anno == 0){
                        echo '<button name="codNota" id="bottoneNota" value=', $codice, '>', $title,'</button>';
                        echo '<button form="noForm" onclick="downloadNota(\''.$title.'\',\''.$content.'\')">Download '.$title.'</button><br>';
                    }else if($anno == $ann){
                        echo '<button name="codNota" id="bottoneNota" value=', $codice, '>', $title,'</button>';
                        echo '<button form="noForm" onclick="downloadNota(\''.$title.'\',\''.$content.'\')">Download '.$title.'</button><br>';
                    }
                }
			}
			echo '</form>';
		}
        ?>-->
    <div class='container-verti'>
        <div class='horizontal'>
            <a href="index.php"><img class="logo" src="img/logo.png"></a>
            <a href="index.php"><button class="top-buttons-style">Home</button></a>
            <a href="aboutPage.html"><button class="top-buttons-style">Chi siamo?</button></a>
            <a href="#"><button class="top-buttons-style">Cerca appunti</button></a>
            <a href="#"><button class="top-buttons-style">Funzionalità</button></a>
            <hr class="line-horizontal">
            <div class="open-zone">
                
                <h1 class="main-title">Appunti</h1>
                <div class="scrollable">
                    <div class="folders" id="folder-math" onclick="cambiaStatoMateria('folder-math')">
                        <h6 class="math" id="titleSub-math">Matematica
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('matematica', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('matematica', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('matematica', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('matematica', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-ita" onclick="cambiaStatoMateria('folder-ita')">
                        <h6 class="ita" id="titleSub-ita">Italiano
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('italiano', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('italiano', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('italiano', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('italiano', $mail, $conn);
                                    } 
                                }
                                ?>
                    </div>
                    <div class="folders" id="folder-storia" onclick="cambiaStatoMateria('folder-storia')">
                        <h6 class="storia" id="titleSub-storia">Storia
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('storia', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('storia', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('storia', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('storia', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-ict" onclick="cambiaStatoMateria('folder-ict')">
                        <h6 class="ict" id="titleSub-ict">Informatica
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('informatica', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('informatica', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('informatica', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('informatica', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-tlc" onclick="cambiaStatoMateria('folder-tlc')">
                        <h6 class="tlc" id="titleSub-tlc">Telecomunicazioni
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('telecomunicazioni', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('telecomunicazioni', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('telecomunicazioni', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('telecomunicazioni', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-tpsi" onclick="cambiaStatoMateria('folder-tpsi')">
                        <h6 class="tpsi" id="titleSub-tpsi">TPSI
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('tpsi', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('tpsi', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('tpsi', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('tpsi', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-storia" onclick="cambiaStatoMateria('folder-storia')">
                        <h6 class="storia" id="titleSub-storia">Storia
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-inglese" onclick="cambiaStatoMateria('folder-inglese')">
                        <h6 class="inglese" id="titleSub-inglese">Inglese
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-chimica" onclick="cambiaStatoMateria('folder-chimica')">
                        <h6 class="chimica" id="titleSub-chimica">Chimica
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-diritto" onclick="cambiaStatoMateria('folder-diritto')">
                        <h6 class="diritto" id="titleSub-diritto">Diritto ed Economia
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-geografia" onclick="cambiaStatoMateria('folder-geografia')">
                        <h6 class="geografia" id="titleSub-geografia">Geografia
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-filosofia" onclick="cambiaStatoMateria('folder-filosofia')">
                        <h6 class="filosofia" id="titleSub-filosofia">Filosofia
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-arte" onclick="cambiaStatoMateria('folder-arte')">
                        <h6 class="arte" id="titleSub-arte">Arte e disegno tecnico
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-meccanica" onclick="cambiaStatoMateria('folder-meccanica')">
                        <h6 class="meccanica" id="titleSub-meccanica">Meccanica
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-elettronica" onclick="cambiaStatoMateria('folder-elettronica')">
                        <h6 class="elettronica" id="titleSub-elettronica">Elettronica
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-scienze" onclick="cambiaStatoMateria('folder-scienze')">
                        <h6 class="scienze" id="titleSub-scienze">Scienze (fisica, della terra, naturali)
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-sistemi" onclick="cambiaStatoMateria('folder-sistemi')">
                        <h6 class="sistemi" id="titleSub-sistemi">Sistemi e Reti
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-biologia" onclick="cambiaStatoMateria('folder-biologia')">
                        <h6 class="biologia" id="titleSub-biologia">Biologia (anatomia, igiene,fisiologia, microbiologia)
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-sta" onclick="cambiaStatoMateria('folder-sta')">
                        <h6 class="sta" id="titleSub-sta">STA
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                    <div class="folders" id="folder-motoria" onclick="cambiaStatoMateria('folder-motoria')">
                        <h6 class="motoria" id="titleSub-motoria">Motoria
                            <h6>
                                <hr class="line-horizontal">
                                <!--<?php
                                if(isset($year)){
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, $year, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn, $year);
                                    }
                                }else{
                                    if(isset($mine)){
                                        mostra('generico', $mail, $conn, 0, $mine);
                                    }else {
                                        mostra('generico', $mail, $conn);
                                    } 
                                }
                                ?>-->
                    </div>
                </div>
                <p class="crea-txt">Crea</p>
                <form action="profile_page.php" method="post">
                    <button value=1 name="creaNota">
                        <img src="img\create.png" class="create-btn">
                    </button>
                </form>

            </div>
        </div>
   
        <hr class="line-vertical">
        <div class='vertical'>
            <img src="img/user.png" class="user-img">
            <h1 class="center-user-name"><!--<?php echo $nomeUtente ?>-->
                <h1>
                    <h3 class="center-user-mail"><!--<?php echo $mail ?>-->
                        <h3>
                            <div class="line-horizontal"></div>
                            <h3 class="divisions">Divisioni</h3>
                            <nav class="division-column">
                                <ul>
                                    <li>
                                        <select id="materia" name="Materia" class="options-dims" onchange="sort('folder-' + this.value, 'folders', this.value)">
            					            <option   value="all">All</option>
  								            <option   value="math">Matematica</option>
  								            <option   value="ita">Italiano</option>
  								            <option   value="ict">Informatica</option>
  								            <option   value="tlc">Telecomunicazione</option>
  								            <option   value="tpsi">TPSI</option>
                                            <option   value="storia">Storia</option>
								            <option   value="inglese">Inglese</option>
                                            <option   value="chimica">Chimica</option>
                                            <option   value="diritto">Diritto ed Economia</option>
                                            <option   value="geografia">Geografia</option>
                                            <option   value="filosofia">Filosofia</option>
                                            <option   value="arte">Arte e disegno tecnico</option>
                                            <option   value="meccanica">Meccanica</option>
                                            <option   value="elettronica">Elettronica</option>
                                            <option   value="math">Scienze</option>
                                            <option   value="sistemi">Sistemi e reti</option>
                                            <option   value="biologia">Biologia</option>
                                            <option   value="sta">STA</option>
                                            <option   value="motoria">Motoria</option>

							            </select>
                                    </li>
                                    <form action="profile_page.php" method="post" id="formFilter">
                                        <li>
                                            <select id="classe" name="Classe" class="options-dims" onchange="submitSelected('classe')">
            					                <option class="centra" value=0>All</option>
  								                <option class="centra" value=1>Prima</option>
  								                <option class="centra" value=2>Seconda</option>
 								                <option class="centra" value=3>Terza</option>
  								                <option class="centra" value=4>Quarta</option>
  								                <option class="centra" value=5>Quinta</option>
							                </select>
                                        </li>
                                        <li>
                                            <select id="proprita" name="Proprieta" class="options-dims" onchange="submitSelected('proprita')">
            					                <option class="centra" value=2>All</option>
  								                <option class="centra" value=1>Creati da te</option>
  								                <option class="centra" value=0>Creati da altri</option>
							                </select>
                                        </li>
                                    </form>
                                    <ul>
                            </nav>
                            <a href="logout.php"><img class="exit-btn" src="img\exit.png"></a>
                            <!--tag probabilmente da cambiare per far uscire l'utente dall'account-->
        </div>
    </div>
</body>

</html>